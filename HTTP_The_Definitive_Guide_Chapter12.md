# 12장 - 기본 인증

- 허가된 사람만이 데이터에 접근하고 업무를 처리할 수 있어야 함
  - 이를 위해 서버가 사용자가 누구인지 식별할 수 있어야 함
- HTTP는 자체적인 인증 관련 기능을 제공
  - 요즘은 각각의 인증 모듈을 이용해 '직접' 구현함

## 12.1 인증

- 인증은 당신이 누구인지 증명하는 것
- 완벽한 인증이란 없음

### 12.1.1 HTTP의 인증 요구/응답 프레임워크

- HTTP는 사용자 인증을 하는 데 사용하는 자체 인증 요구/응답 프레임워크를 제공
- 웹 애플리케이션이 요청 메시지를 받았을 때 서버는 요청을 처리하는 대신 '인증 요구'로 응답할 수 있음
  - 사용자가 다시 요청을 보낼 때는 인증 정보를 첨부해야 함

### 12.1.2 인증 프로토콜과 헤더

- HTTP는 제어 헤더를 통해 다른 인증 프로토콜에 맞추어 확장할 수 있는 프레임워크 제공
- HTTP에는 기본 인증과 다이제스트 인증이라는 두 가지 공식적인 인증 프로토콜이 있음
- 기본 인증
  - 요청 : GET으로 요청
  - 인증 요구 : 헤더는 'WWW-Authenticate'(비밀번호 영역 설명), 서버가 401 요구와 함께 이름과 비밀번호를 요청
  - 인증 : 헤더는 'Authorization', 클라이언트가 헤더에 인증 알고리즘과 사용자 이름, 비밀번호를 기술
  - 성공 : 헤더는 Authentication-Info (선택적 헤더), 서버가 인증 세션에 관한 추가 정보를 기술해서 응답

### 12.1.3 보안 영역

- 웹 서버는 기밀문서를 보안 영역(realm) 그룹으로 나눈다.
  - 보안 영역은 저마다 다른 사용자 권한을 요구
  - HTTP 기본 인증에서도 WWW-Authenticate 헤더에 realm 지시자 기술
- realm은 해설 형식으로 돼서 사용자에게 권한 범위를 이해하는 데 도움이 되어야 함

## 12.2 기본 인증

- 가장 잘 알려진 HTTP 인증 규약
- 서버는 200 대신 401 상태 코드와 함께 WWW-Authenticate에 기술해서 응답하여 인증 요구를 시작
- 브라우저는 Authentication 요청 헤더 안에 사용자 이름과 비밀번호를 암호화해서 서버로 전달

### 12.2.1 기본 인증의 예

- 인증 요구(서버에서 클라이언트로)
  - 각 사이트는 보안 영역마다 다른 비밀번호
  - realm은 요청받은 문서 집합의 이름을 따옴표로 감싼 것
  - WWW-Authenticate: Basic {{realm=따옴표로 감싼 문서 집합 정보}}
- 응답(클라이언트에서 서버로)
  - 사용자 이름과 비밀번호는 콜론으로 이은 후 인코딩
  - base-64로 인코딩 (쉽게 국제문자를 포함할 수 있음 & 네트워크 트래픽에 사용자 이름과 비밀번호가 노출되지 않게 함)
  - Authorization: Basic {{base-64로 인코딩한 사용자 이름과 비밀번호}}
- 기본 인증 프로토콜은 Authentication-Info 헤더를 사용하지 않음

### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

- base-64 인코딩은 8비트 바이트로 이루어져 있는 시퀀스를 6비트 덩어리의 시퀀스로 변환
  - 각 6비트 조각은 대부분 문자와 숫자로 이루어진 특별한 64개의 문자 중에서 선택됨
- Base-64 인코딩은 바이너리, 텍스트, 국제 문자 데이터 문자열을 원본 문자열이 변질될 걱정 없이 디코딩 할 수 있게 발명
  - 국제 문자나 HTTP 헤더에서 사용할 수 없는 문자를 포함한 자료를 보내야 할 때 유용함

### 12.2.3 프락시 인증

- 중개 프락시 서버를 통해 인증할 수도 있음
  - 프락시 서버에서 접근 정책을 중앙 관리할 수 있음
- 웹 서버와 프락시 인증에서 쓰이는 상태 코드와 헤더들의 대조
  - 401 -> 407
  - WWW-Authenticate -> Proxy-Authenticate
  - Authorization -> Proxy-Authorization
  - Authentication-Info -> Proxy-Authentication-Info

## 12.3 기본 인증의 보안 결함

- 사용자 이름과 비밀번호를 쉽게 디코딩 할 수 있는 형식으로 네트워크에 전송
  - 인코딩 절차를 반대로 수행해서 어렵지 않게 디코딩 가능
  - 사실상 비밀번호 그대로 보내는 것과 같음
- 더 복잡한 방식으로 인코딩 되어도 제삼자가 인코딩 된 것을 캡처하여 원 서버에 보내 인증을 선공하는 재전송 공격에 대한 대비가 없음
- 기본 인증을 사용하는 사이트에서 사용한 비밀번호를 사용자들이 다른 사이트에서도 똑같은 비밀번호를 사용한다면 이를 악의적으로 이용할 수 있음
- 인증 헤더 외에 다른 부분을 수정하는 프락시나 중개자가 개입되는 경우 기본 인증의 정상적인 동작을 보장 X
- 기본 인증은 가짜 서버의 위장에 취약
  - 가짜 서버에 비밀번호를 보낼 수 있음
- 노출이 되어도 치명적이지 않은 경우에는 여전히 기본 인증이 여전히 유용
- 기본 인증은 암호화된 데이터 전송(SSL과 같은)과 함께 연계해서 사용 가능
