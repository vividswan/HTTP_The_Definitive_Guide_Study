# 19장 - 배포 시스템

- 많은 종류의 도구가 HTTP 프로토콜을 확장하여 콘텐츠의 원격 배포 기능을 지원

## 19.1 배포 지원을 위한 FrontPage 서버 확장

- FrontPage
  - 보통 FP라 부름
  - 다양한 기능을 제공하는 마이크로소프트사의 웹 개발 및 배포 도구 집합

### 19.1.1 FrontPage 서버 확장

- FrontPage Server Extensions(FPSE)라는 서버 측 소프트웨어 제폼군을 출시
- 서버 측 컴포넌트는 웹 서버와 통합되어 FrontPage를 구동시키는 클라이언트 사이에서 필요한 변환 작업 수행
- FP 클라이언트와 FPSE 사이에서 사용하는 배포 프로토콜이 중요
  - HTTP의 기본 의미를 바꾸지 않고 그대로 사용할 수 있게 확장을 설계
- 웹 서버는 FPSE에 맞춘 POST 요청을 받아 처리
  - HTTP POST 요청 위에 RPC 계층을 구현 (웹 사이트 문서 갱신, 검색 수행, 공동 작업 수행 가능)
  - POST 메서드 통신만 할 수 있다면 FrontPage는 서버와 통신을 계속할 수 있음

### 19.1.2 FrontPage 용어

- 가상 서버
  - 같은 서버의 여러 웹 사이트는 유일한 도메인 이름과 IP 주소를 가짐
  - 다중 호스틍 웹 서버 : 가상 서버를 지원하는 웹 서버
  - 다중-홈 서버 : 여러 개의 IP 주소로 구성된 장비
- 루트 웹
  - 웹 서버의 최상위 콘텐츠 디렉트 or 다중 호스팅 환경에서 가상 웹 서버의 최상위 콘텐츠 디렉터리
  - 서버의 URL만 기술하여 접근
  - 웹 서버에는 오직 하나의 루트 웹만 존재
- 서브 웹
  - 루트 웹의 하위 디렉터리 or 완전한 FPSE 확장 웹인 다른 서브 웹의 하위 디렉터리
  - 검색 범위의 단위로 사용 가능
  - 관리나 저작의 권한을 자체적으로 제한하는 독립적인 엔터티가 될 수 있음

### 19.1.3 FrontPage RPC 프로토콜

- FrontPage 클라이언트와 FPSE는 자체 RPC 프로토콜을 사용해 통신
  - RPC 메서드와 그와 관련한 변수를 POST 요청의 본문에 기술해서 HTTP POST를 감싼
- 클라이언트는 특별한 GET 요청으로 서버에 있는 대상 프로그램의 이름과 위치를 결정
  - 반환된 파일로 FrontPage 클라이언트는 응답을 읽고 관련 값을 찾음
  - `FPShtmlScroptUrl`은 탐색 시간 명령에 관한 POST 요청을 보낼 위치를 알려줌
  - `FPAuthorScriptUrl`은 저작 시간 명령에 관한 POST 요청을 보낼 위치를 알려줌
  - `FPAdminScriptUrl`은 관리 동작에 관한 POST 요청을 보낼 위치를 알려줌
- 요청
  - POST 요청의 본문에는 "method=\<command>" 형식의 RPC 명령과 함께 매개변수 기술
  - 인코딩 된 기호들을 바꾸면 본문이 더 가독성 있어짐
  - service_name : 메서드가 수행되어야 하는 웹 사이트의 URL
  - listHiddenDocs : 값이 "true"면 숨겨진 웹의 문서가 보임
  - listExploreDocs : 값이 "true"면 태스크 리스트를 나열
- 응답
  - 일반적으로 성공 메서드 or 에러
  - 어떤 메서드는 "Sample Return Code"를 포함하기도 함
  - 웹 서버에서 유효한 문서의 목록을 특정 형식에 맞추어 작성해 FP 클라이언트에게 반환

### 19.1.4 FrontPage 보안 모델

- FPSE의 보안은 웹 서버에 의존
- 사용자를 세 가지로 정의
  - 관리자, 저작자, 일반 사용자
  - 모든 권한은 누적
- 특정 FPSE 확장 웹에 따라 사용자의 목록이 달라짐
- 서브 웹은 루트 웹에서 권한을 상속 or 자체 권한
- IIS가 아닌 웹 서버는 모든 FPSE 프로그램이 "excutable" 표시가 된 디렉터리에 저장되어야 함
- IIS 서버에서는 통합된 윈도우 보안 모델이 우선 적용
  - 권한이 있는지에 대한 검사는 주어진 루트나 서브 루트에 대한 ACL을 보고 검사 (DDL 중 하나에 보냄)
  - 그 외 서버에서는 허가된 사용자들을 따로 기술 (다양한 권한 등급의 사용자, 그룹, IP 주소 기술)

## 19.2 WebDAV와 공동 저작

- 웹 분산 저작과 버저닝(Web Distributed Authoring and Versioning, WebDAV)
  - 웹 배포 공동 작업에 대한 또 다른 영역을 개척
  - 공동 저작에 적합한 플랫폼을 제공하려고 HTTP를 확장하는데 집중
  - 여러 업체들의 지원과 협력 관계

### 19.2.1 WebDAV 메서드

- WebDAV가 추가한 새로운 메서드
  - PROPFIND : 리소스의 속성 읽음
  - PROPPATCH : 한 개 이상의 리소스에 대해 한 개 이상의 속성 설정
  - MKCOL : 콜렉션 생성
  - COPY : 특정 원본지에서 특정 목적지로 리소스나 리소스의 집합 복사
  - MOVE : 특정 소스에서 특정 목적지에 리소스나 리소스의 집합 이동
  - LOCK : 하나 이상의 리소스를 잠금
  - UNLOCK : 기존에 잠겨있는 리소스를 잠금 해제

### 19.2.2 WebDAV와 XML

- HTTP는 보통 WebDAV의 메서드 요청과 응답 관련 정보를 헤더에 담아 전달
  - 헤더에 담는 건 한계가 있음
  - 이 한계를 해결하기 위해 XML(Extensible Markup Language)을 지원
- XML을 다음과 같은 용도로 사용
  - 명령 포맷
  - 응답 표현에 사용되는 포맷
  - 커스텀 정보 포맷
  - 데이터 자체를 표현하는 유연한 포맷
  - 국제화 문제에 대한 해결책
- WebDAV는 "DAV:"라는 별도의 XML 이름 공간을 정의
  - 도메인 전체에서 유일한 이름 보장

### 19.2.3 WebDAV 헤더

- 새로운 메서드들의 기능을 더 넓혀주는 여러 HTTP 헤더 도입
- DAV
  - WebDAV를 제공하는 서버와 통신할 때 사용
  - OPTIONS 요청에 대한 응답에 이 헤더 포함
- Depth
  - 여러 수준의 계층 구조로 분류된 리소스에 WebDAV를 사용하기 위한 중요한 요소
- Destination
  - COPY나 MOVE 메서드가 목적지 URI를 식별하는데 쓰임
- If
  - If 헤더는 조건 집합을 정의
  - 조건들에 모두 맞지 않으면 요청은 실패
- Lock-Token
  - 제거되어야 할 잠금을 명시하는 용도로 UNLOCK 메서드에서 사용
- Overwrite
  - 대상을 덮어쓸 것인지 아닌지를 기술
- Timeout
  - 클라이언트가 필요한 잠금 타임아웃 값을 기술하는 데 사용하는 요청 헤더

### 19.2.4 WebDAV 잠금과 덮어쓰기 방지

- 공동 작업
  - 주어진 문서에 한 명 이상의 사람이 붙어서 작업하는 것
- 공동 작업의 문제(독립적으로 문서를 변경)를 개선하기 위해 WebDAV는 잠금(lock)을 지원
  - 문제의 완벽한 해결책은 아님
  - 완벽한 해결을 위해선 버저닝과 메시징 지원이 필요
- 리소스나 콜렉션에 대한 배타적 쓰기 잠금
  - 잠금 소유자만 쓸 수 있게 보장
  - 잠재적인 충돌 완벽 제거
- 리소스나 콜렉션에 대한 공유된 쓰기 잠금도 지원
- 잠금을 수행하려면 저자를 식별하기 위해 다이제스트 인증을 요구
- LOCK, UNLOCK 두 개의 메서드로 잠금 지원
- 잠금이 승인되면 유일한 토큰 반환

### 19.2.5 LOCK 메서드

- WebDAV는 한 개의 LOCK 요청으로 여러 개의 리소스를 잠글 수 있음
- LOCK 요청인 xml의 \<lockinfo> 구조 안에 세 개의 하위 요소
  - \<locktype> : 잠금 형식을 가리킴
  - \<lockscope> : 배타적 잠금인지 공유된 잠금인지 가리킴
  - \<owner> : 현재 잠금을 가지고 있는 사람이 기술되어 있는 필드
- \<lockdiscovery> : 잠금에 대한 정보를 담는 컨테이너 역할
- \<lockdiscovery> 하위의 \<activelock> : 요청과 함께 전송된 정보를 담는 하위 요소
- \<activelock> 하위 요소들
  - \<locktoken> : 잠금을 식별하는 데 사용 (URI 스킴의 opaquelocktoken)
  - \<depth> : depth 헤더와 같은 값
  - \<timeout> : 잠금에 대한 타임아웃
- opaquelocktoken 스킴
  - 모든 리소스에 유일한 토큰을 제공하기 위해 설계
  - UUID 메커니즘 사용
- \<lockdiscovery> XML 요소
  - 활성화되어 있는 잠금을 찾는 메커니즘을 제공
  - 자체 속성과 함께 아직 처리되지 않은 모든 잠금 기술
- 잠금 갱신과 Timeout 헤더
  - 잠금을 갱신하려면 클라이언트는 If 헤더에 잠금 토큰과 함께 잠금 요청을 다시 보내야 함
  - 반환된 timeout 값은 이전의 timeout 값과는 다름
  - 클라이언트는 LOCK 요청 안에 필요한 timeout 값을 기술
  - \<timeout> 잠금 요소에 잠금 파기 시간을 제공해야 함

### 19.2.6 UNLOCK 메서드

- UNLOCK이 성공하기 위한 두 가지 조건
  - 다이제스트 인증을 성공적으로 완료하는 것
  - Lock-Token 헤더에 보내는 잠금 토큰이 맞는지 검사하는 것

### 19.2.7 속성과 META 데이터

- 속성에는 리소스의 정보를 기술
  - 저작자의 이름, 수정한 날짜, 내용 등급 등 ...
- 'live' 속성 : WebDAV 용어로 동적 수정 속성
- 'dead' 속성 : Content-Type과 같은 정적 속성
- 속성의 발견과 수정을 지원하기 위해 WebDAV는 PROPFIND와 PROPPATCH 메서드를 포함해 HTTP를 확장

### 19.2.8 PROPFIND 메서드

- 주어진 파일이나 파일 그룹의 속성을 읽는데 사용
- 세 가지 형식의 동작 지원
  - 모든 속성과 그 값 요청
  - 선택된 속성과 그 값의 집합 요청
  - 모든 속성의 이름 요청
- PROPFIND 요청과 함께 사용하는 몇몇 XML 요소
  - \<allprop> : 반환될 모든 속성의 이름과 값을 기술
  - \<propname> : 반환될 속성 이름의 집합을 기술
  - \<prop> : 하위 요소로 반환될 값의 속성을 기술
- PROPFIND에 대해 응답에 있는 요소들
  - \<multistatus> : 여러 응답을 담는 컨테이너
  - \<href> : 리소스의 URL
  - \<status> : 특정 요청에 대한 HTTP 상태 코드
  - \<propstat> : \<status> 요소 한 개와 \<prop> 요소 한 개로 이루어져 있는 집합

### 19.2.9 PROPPATCH 메서드

- 특정 리소스의 여러 속성을 설정하거나 제거하는 원자적 메커니즘 제공
  - 원자성은 모든 요청이 성공하거나 모든 요청이 무효
- \<set> : 설정한 속성을 기술
- \<remove> : 제거할 속성을 기술

### 19.2.10 콜렉션과 이름공간 관리

- 콜렉션은 사전에 정의한 계층에 있는 리소스들의 논리적 혹은 물리적 그룹
  - 모범적인 예는 디렉터리
- WebDAV는 XML 이름공간 메커니즘 사용
  - 명확한 구조적 제어 기능 제공

### 19.2.11 MKCOL 메서드

- 클라이언트가 지정된 URL에 해당하는 콜렉션을 서버에 생성하게 함
- MKCOL 대신 기존의 PUT이나 POST 메서드를 사용하지 않는 이유
  - 콜랙션을 생성할 목적으로 PUT이나 POST를 사용하려면 클라이언트는 요청 안에 추가적인 정보를 더해 보는 식으로 프로토콜 만들어야 함
    - 번거롭고 오류 발생 가능
  - 다른 메서드들을 본래 용도와 다르게 사용하려면 접근 제어 메커니즘은 잘 동작 X

### 19.2.12 DELETE 메서드

- 디렉터리를 지우려고 하려면 Depth 헤더가 필요
  - 없을 시 헤더가 무한으로 설정되어 있다고 가정 -> 하위 모든 디렉터리까지 삭제
- 콜렉션이 잠겨 있어서 지울 수 없는 경우는 207 Multi-Status 상태 코드 반환

### 19.2.13 COPY와 MOVE 메서드

- GET 요청이나 PUT 요청을 사용한 대안은 다단계 콜랙션에 대한 COPY나 MOVE 작업을 할 때 발생하는 모든 문제에 대한 확장이 쉽지 않음
- COPY와 MOVE 메서드는 요청 URL을 원본의 위치 정보로 사용
- 목적지인 Destination HTTP 헤더의 값을 목적지 정보로 사용
- 콜렉션 처리 시 Depth 헤더에 영향을 받음
  - 없을 시 무한대 깊이로 가정
  - 0일 시 해당 리소스에만 적용
- Overwrite 헤더의 영향
  - T로 설정하였고 목적지가 존재한다면 작업 수행 전 무한대 값을 가진 Depth와 함께 DELETE가 목적지 리소스에 수행
  - F로 설정하였고 목적지 리소스가 존재한다면 작업은 실패
- COPY/MOVE의 속성
  - 콜렉션이나 요소를 복사하면 기본적으로 그것들의 모든 속성도 복사
  - XML 본문을 포함할 때 모든 속성이나 어떤 속성만 복사하려고 하는지 기술 가능
- 잠긴 리소스와 COPY/MOVE
  - 리소스가 현재 잠겨있으면 COPY, MOVE 모드 금지

### 19.2.14 향상된 HTTP/1.1 메서드

- WebDAV는 HTTP 메서드의 DELETE, PUT, OPTIONS의 의미를 수정, GET, HEAD는 그대로 둠
- POST 요청이 수행하는 작업은 항상 특정 서버 구현에 따라 다름
- PUT 메서드
  - 저작자가 공용 사이트에 콘텐츠를 전송하는 유일한 방법
  - 잠금을 제공하기 위해 If 헤더를 추가
- OPTIONS 메서드
  - WebDAV를 사용하는 클라이언트가 보내는 첫 요청에 쓰임
  - WebDAV 서버가 어떤 것들을 제공하는지 알아볼 수 있음

### 19.2.15 WebDAV의 버전 관리

- 이전 문서의 버전을 저장하고 접근하는 것과 변경 기록과 변경에 대해 자세한 내용이 기술된 주석을 관리하는 것이 버저닝과 관련된 일부 기능

### 19.2.16 WebDAV의 미래

- WebDAV는 여러 클라이언트와 서버, 운영체제에서 현재도 잘 지원
